@{
    ViewData["Title"] = "Home Page";
}

<link rel="stylesheet" href="~/css/Table2.css">



<div class="text-center">
   
    <div id="Welcome">
        Что будем кушать?
    </div>

    <div id="table">
        <table class="table2">
            <tr>
            <th width="250">Блюдо</th>
            <th width="150">Цена</th>
            <th width="150">Общая цена</th>
            <th width="150">Количество</th>
            </tr>

            <tr v-for="item in data">
            <td>
                <input type="hidden" v-model="item.id" />
                <input v-model="item.name" />
            </td>
            <td>
                <input v-model="item.price" />
            </td>
            <td>
                <input/>
            </td>
            <td>
                <div class="plus-minus">
                        <button class="minus" v-on:click="DecCount(item)">-</button>
                        <div>{{item.count}}</div>
                        <button class="plus" v-on:click="item.count += 1">+</button>
                </div>
            </td>
        </tr>
        </table>
        <button v-on:click="Order" class="Order">Заказать</button>
        <button v-on:click="logout" class="button" id="button_logout">Выйти</button>
    </div>
    

    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="~/js/air-datepicker.js"></script>
    <script>
        async function GetProductsForOrder() {
        return await fetch("home/GetProductsForOrder",{
            method: 'POST'
        })
        }

        async function GetAllOrders() {
            return await fetch("home/GetAllOrders", {
                method: 'POST'
            })
        }

        const Table = {
        data() {            
            return {
                data: []
            }
        },
        async mounted() {
            const response = await GetProductsForOrder();
            console.log(response);
            let data = await response.json();
            this.data = data;
            for(let i = 0; i < data.length; i++){
            data[i].count = 0;   
            }
                const response1 = await GetAllOrders();
                console.log(await response1.json());
        },
        methods:{
            DecCount: function(item){
                if (item.count > 0)
                    item.count--
            },
                logout: function () {
                    fetch("account/logout", {
                        method: 'POST'
                    }).then(() => {
                        location.reload();
                    })
                },
                    Order: async function(){
                let orders = new Array();
                for(let i = 0; i < this.data.length; i++){
                    orders.push({ProductId: this.data[i].id, Count: this.data[i].count})
                }
                $.ajax({
                dataType: 'json',
                contentType: "application/json",
                method: "post",
                url: "/home/DoOrder",
                data: JSON.stringify(orders),
                success: function (data) {
                },
                error: function (er) {
                }
                });                  
            }
        }
    }

    Vue.createApp(Table).mount('#table')



        var group = { 'listofusers': listofusers };
        console.log(group);
        $.ajax({
            dataType: 'json',
            type: "POST",
            url: "/Home/GetMassiv",
            data: group,
            success: function (data) {
                console.log("output : " + JSON.stringify(data));
            },
            error: function (data) {
                console.log("error : " + JSON.stringify(data));
            },
        });
    </script>
</div>
